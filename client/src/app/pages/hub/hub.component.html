<div class="hub-container">
    <!-- Header -->
    <header class="hub-header glass">
        <div class="header-left">
            <span class="logo">üéÆ</span>
            <h1 class="title">Node Play</h1>
            @if (socketService.isDev()) {
            <span class="dev-badge">DEV</span>
            }
            <div class="online-indicator">
                <span class="online-dot"></span>
                <span class="online-count">{{ socketService.onlineCount() }} online</span>
            </div>
        </div>
        <div class="header-right">
            <div class="player-info" [class.renaming]="isRenaming()">
                @if (isRenaming()) {
                <input type="text" [value]="newName()" (input)="newName.set($any($event.target).value)"
                    (keyup.enter)="confirmRename()" class="name-input" autofocus>
                <div class="player-actions">
                    <button class="btn-icon-small success" (click)="confirmRename()" title="Sauvegarder">‚úÖ</button>
                    <button class="btn-icon-small cancel" (click)="cancelRenaming()" title="Annuler">‚ùå</button>
                </div>
                } @else {
                <span class="player-avatar">üë§</span>
                <span class="player-name">{{ socketService.currentPlayer()?.username }}</span>
                <div class="player-actions">
                    <button class="btn-icon-small edit" (click)="startRenaming()" title="Renommer">‚úèÔ∏è</button>
                    <button class="btn-icon-small logout" (click)="logout()" title="D√©connexion">üö™</button>
                </div>
                }
            </div>
            <button class="btn btn-icon btn-secondary" (click)="themeService.toggle()">
                @if (themeService.theme() === 'dark') {
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5" />
                    <path
                        d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                </svg>
                } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                </svg>
                }
            </button>
        </div>
    </header>

    <main class="hub-main container">
        <!-- Section: Cr√©er une partie -->
        <section class="section animate-slideUp">
            <div class="section-header">
                <h2>Cr√©er une partie</h2>
            </div>

            <div class="games-grid">
                <!-- Carte Skyjo -->
                <div class="game-card card">
                    <div class="game-icon">üÉè</div>
                    <h3 class="game-title">Skyjo</h3>
                    <p class="game-description">Jeu de cartes strat√©gique. Collectez le moins de points possible !</p>
                    <div class="game-info">
                        <span class="badge badge-success">2-8 joueurs</span>
                    </div>
                    <div class="game-actions">
                        <button class="btn btn-primary"
                            (click)="openCreateModal('skyjo'); $event.stopPropagation()">Multijoueur</button>
                        <button class="btn btn-secondary btn-solo"
                            (click)="openSoloModal(); $event.stopPropagation()">ü§ñ Solo</button>
                    </div>
                </div>

                <!-- Placeholder pour futurs jeux -->
                <div class="game-card card game-card-coming">
                    <div class="game-icon">üé≤</div>
                    <h3 class="game-title">Bient√¥t...</h3>
                    <p class="game-description">D'autres jeux arrivent prochainement !</p>
                </div>
            </div>
        </section>

        <!-- Section: Parties publiques -->
        <section class="section animate-slideUp" style="animation-delay: 0.1s">
            <div class="section-header">
                <h2>Parties publiques</h2>
                <button class="btn btn-secondary" (click)="refreshRooms()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6" />
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                    </svg>
                    Actualiser
                </button>
            </div>

            @if (socketService.publicRooms().length === 0) {
            <div class="empty-state card">
                <div class="empty-icon">üîç</div>
                <p>Aucune partie publique en cours</p>
                <p class="text-muted">Cr√©ez-en une ou rejoignez avec un code !</p>
            </div>
            } @else {
            <div class="rooms-list">
                @for (room of socketService.publicRooms(); track room.id) {
                <div class="room-card card" (click)="joinRoom(room.id)">
                    <div class="room-info">
                        <h4>{{ room.name }}</h4>
                        <p class="room-game">{{ getGameName(room.gameType) }}</p>
                    </div>
                    <div class="room-meta">
                        <span class="room-players">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                <circle cx="9" cy="7" r="4" />
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" />
                            </svg>
                            {{ room.players.length }}/{{ room.maxPlayers }}
                        </span>
                        <button class="btn btn-primary">Rejoindre</button>
                    </div>
                </div>
                }
            </div>
            }
        </section>

        <!-- Section: Rejoindre avec code -->
        <section class="section animate-slideUp" style="animation-delay: 0.2s">
            <div class="section-header">
                <h2>Rejoindre une partie priv√©e</h2>
            </div>

            <form class="join-form card" (submit)="joinPrivateRoom($event)">
                <input type="text" class="input" placeholder="Entrez le code de la partie..." [value]="privateCode()"
                    (input)="onCodeChange($event)" maxlength="10" />
                <button type="submit" class="btn btn-primary" [disabled]="!privateCode()">
                    Rejoindre
                </button>
            </form>
        </section>
    </main>

    <!-- Modal de cr√©ation -->
    @if (showCreateModal()) {
    <div class="modal-overlay" (click)="closeCreateModal()">
        <div class="modal card animate-scaleIn" (click)="$event.stopPropagation()">
            <h3 class="modal-title">Cr√©er une partie {{ getGameName(selectedGame()!) }}</h3>

            <form (submit)="createRoom($event)">
                <div class="form-group">
                    <label class="form-label">Nom de la partie</label>
                    <input type="text" class="input" placeholder="Ma super partie..." [value]="roomName()"
                        (input)="onRoomNameChange($event)" maxlength="30" />
                </div>

                <div class="form-group">
                    <label class="form-label">Visibilit√©</label>
                    <div class="visibility-options">
                        <button type="button" class="visibility-option" [class.active]="!isPrivate()"
                            (click)="isPrivate.set(false)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                            </svg>
                            <span>Publique</span>
                            <small>Visible par tous</small>
                        </button>
                        <button type="button" class="visibility-option" [class.active]="isPrivate()"
                            (click)="isPrivate.set(true)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                            </svg>
                            <span>Priv√©e</span>
                            <small>Avec code secret</small>
                        </button>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">
                        Annuler
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Cr√©er la partie
                    </button>
                </div>
            </form>
        </div>
    </div>
    }

    <!-- Modal Solo -->
    @if (showSoloModal()) {
    <div class="modal-overlay" (click)="closeSoloModal()">
        <div class="modal card animate-scaleIn" (click)="$event.stopPropagation()">
            <h3 class="modal-title">ü§ñ Mode Solo - Skyjo</h3>

            <div class="form-group">
                <label class="form-label">Nombre d'adversaires IA</label>
                <div class="bot-slider">
                    <input type="range" min="1" max="7" [value]="numBots()" (input)="onNumBotsChange($event)"
                        class="slider" />
                    <span class="bot-count">{{ numBots() }} Bot{{ numBots() > 1 ? 's' : '' }}</span>
                </div>
                <div class="bot-preview">
                    @for (i of [1,2,3,4,5,6,7]; track i) {
                    <span class="bot-icon" [class.active]="i <= numBots()">ü§ñ</span>
                    }
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" (click)="closeSoloModal()">
                    Annuler
                </button>
                <button type="button" class="btn btn-primary" (click)="startSoloGame()">
                    üéÆ Jouer
                </button>
            </div>
        </div>
    </div>
    }

    @if (socketService.error()) {
    <div class="toast toast-error animate-slideUp">
        {{ socketService.error() }}
        <button class="toast-close" (click)="socketService.clearError()">√ó</button>
    </div>
    }
</div>