<div class="lobby-container">
    <header class="lobby-header glass">
        <button class="btn btn-secondary" (click)="leaveRoom()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            Quitter
        </button>
        <div class="header-center">
            <h1>{{ socketService.currentRoom()?.name }}</h1>
        </div>
        <button class="btn btn-icon btn-secondary" (click)="themeService.toggle()">
            @if (themeService.theme() === 'dark') {
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5" />
                <path
                    d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
            </svg>
            } @else {
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
            </svg>
            }
        </button>
    </header>

    <main class="lobby-main container">
        <!-- Info partie priv√©e -->
        @if (socketService.currentRoom()?.isPrivate) {
        <div class="private-code-banner card animate-fadeIn">
            <div class="code-info">
                <span class="code-label">Code de la partie:</span>
                <span class="code-value">{{ socketService.currentRoom()?.privateCode }}</span>
            </div>
            <button class="btn btn-secondary" (click)="copyCode()">
                @if (codeCopied()) {
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12" />
                </svg>
                Copi√© !
                } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                </svg>
                Copier
                }
            </button>
        </div>
        }

        <div class="lobby-content">
            <!-- Liste des joueurs -->
            <section class="players-section card animate-slideUp">
                <h2>
                    Joueurs
                    <span class="player-count">({{ socketService.currentRoom()?.players?.length }}/{{
                        socketService.currentRoom()?.maxPlayers }})</span>
                </h2>

                <div class="players-list">
                    @for (player of socketService.currentRoom()?.players; track player.id) {
                    <div class="player-item" [class.is-host]="player.isHost" [class.is-ready]="player.isReady"
                        [class.is-bot]="player.isBot">
                        <div class="player-avatar">
                            @if (player.isBot) {
                            ü§ñ
                            } @else if (player.isHost) {
                            üëë
                            } @else {
                            üë§
                            }
                        </div>
                        <div class="player-info">
                            <span class="player-name">{{ player.username }}</span>
                            @if (player.isHost) {
                            <span class="badge badge-warning">H√¥te</span>
                            }
                            @if (player.isBot) {
                            <span class="badge badge-info">Bot</span>
                            }
                        </div>
                        <div class="player-status">
                            @if (player.isHost) {
                            <span class="status-text">-</span>
                            } @else if (player.isBot) {
                            <span class="badge badge-success">Pr√™t</span>
                            @if (socketService.isHost()) {
                            <button class="btn-remove-bot" (click)="removeBot(player.id)">√ó</button>
                            }
                            } @else if (player.isReady) {
                            <span class="badge badge-success">Pr√™t</span>
                            } @else {
                            <span class="badge badge-danger">En attente</span>
                            }
                        </div>
                    </div>
                    }
                </div>

                @if (socketService.isHost() && canAddBot()) {
                <button class="btn btn-secondary btn-add-bot" (click)="addBot()">
                    ü§ñ Ajouter un Bot
                </button>
                }
            </section>

            <!-- R√®gles du jeu -->
            <section class="rules-section card animate-slideUp" style="animation-delay: 0.1s">
                <h2>R√®gles Skyjo</h2>
                <div class="rules-content">
                    <div class="rule">
                        <span class="rule-icon">üéØ</span>
                        <div>
                            <strong>Objectif</strong>
                            <p>Avoir le moins de points possible</p>
                        </div>
                    </div>
                    <div class="rule">
                        <span class="rule-icon">üÉè</span>
                        <div>
                            <strong>Cartes</strong>
                            <p>Valeurs de -2 √† +12</p>
                        </div>
                    </div>
                    <div class="rule">
                        <span class="rule-icon">üîÑ</span>
                        <div>
                            <strong>Tour</strong>
                            <p>Piochez puis √©changez ou r√©v√©lez</p>
                        </div>
                    </div>
                    <div class="rule">
                        <span class="rule-icon">‚ú®</span>
                        <div>
                            <strong>Bonus</strong>
                            <p>3 cartes identiques en colonne = disparition !</p>
                        </div>
                    </div>
                    <div class="rule">
                        <span class="rule-icon">üèÅ</span>
                        <div>
                            <strong>Fin</strong>
                            <p>Premier √† 100 points perd</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Actions -->
        <div class="lobby-actions animate-slideUp" style="animation-delay: 0.2s">
            @if (socketService.isHost()) {
            <button class="btn btn-primary btn-large" [disabled]="!canStart()" (click)="startGame()">
                @if (canStart()) {
                Lancer la partie
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <polygon points="5 3 19 12 5 21 5 3" />
                </svg>
                } @else {
                En attente des joueurs...
                }
            </button>
            } @else {
            <button class="btn btn-large" [class.btn-primary]="!isReady()" [class.btn-success]="isReady()"
                (click)="toggleReady()">
                @if (isReady()) {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12" />
                </svg>
                Pr√™t !
                } @else {
                Cliquez quand vous √™tes pr√™t
                }
            </button>
            }
        </div>
    </main>

    @if (socketService.error()) {
    <div class="toast toast-error animate-slideUp">
        {{ socketService.error() }}
        <button class="toast-close" (click)="socketService.clearError()">√ó</button>
    </div>
    }
</div>